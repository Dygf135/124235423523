name: Capture Website Screenshot (Headful Mode)

on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  capture_screenshot:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v3
    
    - name: Set up Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '18'
        
    - name: Install dependencies
      run: |
        sudo apt-get update
        sudo apt-get install -y xvfb
        echo '{"name": "screenshot-action", "version": "1.0.0", "private": true}' > package.json
        npm install puppeteer@19.11.1
        
    - name: Capture screenshot in headful mode
      run: |
        xvfb-run --auto-servernum --server-args="-screen 0 1280x960x24" node -e "
        const puppeteer = require('puppeteer');
        (async () => {
          const browser = await puppeteer.launch({
            headless: false,
            args: ['--no-sandbox', '--disable-setuid-sandbox']
          });
          const page = await browser.newPage();
          await page.setViewport({width: 1280, height: 960});
          await page.goto('https://example.com');
          await page.screenshot({path: 'screenshot.png'});
          await browser.close();
        })().catch(err => {
          console.error(err);
          process.exit(1);
        });
        "
        
    - name: Upload screenshot
      uses: actions/upload-artifact@v3
      with:
        name: website-screenshot
        path: screenshot.png
